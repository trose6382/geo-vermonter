<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="border.js"></script>
    <script src="http://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
    crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
    crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
    <link href="style.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script>
    <script src="https://unpkg.com/@mapbox/leaflet-pip@latest/leaflet-pip.js"></script>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Didact+Gothic" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
                aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            
            <a class="navbar-brand" href="#">
                <img id="logo" src="geovermonterLogo.png">
            </a>
        </div>
        
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="#">About
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="highScoresButton">High Scores</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#">Contact Us</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
</nav>

<div class="info">
    <div id="county">County</div>
    <div id="lat">Latitude</div>
    <div id="long">Longitude</div>
    <div id="score">Score</div>
</div>

<div id='endBanner'>
    <h2>
        How well do you know Vermont? See if you can guess in which county you land in as few moves as possible.
    </h2>
    
</div>

<div class="modal" id="highScoresModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success">
                <div class='row'>
                <h1 class="modal-title col-sm-11">High Scores</h1>
                <button type="button" class="close col-sm-1" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
            </div>
            <div class="modal-body row">
                <ol  id="highScoresList" class="list-group col-sm-12">
                    
                </ol>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div id="mapid">
    <div id="nav-column" class="col-sm-2">
        <div id="countyGuide">
            <img class="county Addison" src="Addison.png" onClick="alert('Addison County')">
            <img class="county Bennington" src="Bennington.png" onClick="alert('Bennington County')">
            <img class="county Caledonia" src="Caledonia.png" onClick="alert('Caledonia County')">
            <img class="county Chittenden" src="Chittenden.png" onClick="alert('Chittenden County')">
            <img class="county Essex" src="Essex.png" onClick="alert('Essex County')">
            <img class="county Franklin" src="Franklin.png" onClick="alert('Franklin County')">
            <img class="county Grand-Isle" src="Grand Isle.png" onClick="alert('Grand Isle County')">
            <img class="county Lamoille" src="Lamoille.png" onClick="alert('Lamoille County')">
            <img class="county Orange" src="Orange.png" onClick="alert('Orange County')">
            <img class="county Orleans" src="Orleans.png" onClick="alert('Orleans County')">
            <img class="county Rutland" src="Rutland.png" onClick="alert('Rutland County')">
            <img class="county Washington" src="Washington.png" onClick="alert('Washington County')">
            <img class="county Windham" src="Windham.png" onClick="alert('Windham County')">
            <img class="county Windsor" src="Windsor.png" onClick="alert('Windsor County')">
            <img class="county Vermont" src="vermont-county-map.png">
            
        </div>
        
    </div>
    <div class="col-sm-9"></div>
    <div id="button-column" class="col-sm-1">
        <button id="start" type="button" class="btn btn-success">Start Game</button>
        <button id="guess" disabled type="button" class="btn btn-primary" data-toggle="modal" data-target="#guessModal">Guess Spot</button>
        <button id="quit" disabled type="button" class="btn btn-info">Give Up!</button>
        
        <nav id="panButtons">
            <ul>
                <li id='navUp'>
                    <a href="#">
                        <span class="glyphicon glyphicon-chevron-up"></span>
                    </a>
                </li>
                <li id='navRight'>
                    <a href="#">
                        <span class="glyphicon glyphicon-chevron-right"></span>
                    </a>
                </li>
                <li id='navLeft'>
                    <a href="#">
                        <span class="glyphicon glyphicon-chevron-left"></span>
                    </a>
                </li>
                <li id='navDown'>
                    <a href="#">
                        <span class="glyphicon glyphicon-chevron-down"></span>
                    </a>
                </li>
                <li id='navHome'>
                    <a href="#">
                        <span class="glyphicon glyphicon-map-marker"></span>
                    </a>
                </li>
            </ul>
            
        </nav>
    </div>
    <div class="modal fade" id="guessModal" tabindex="-1" role="dialog" aria-labelledby="guessModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <div class='row'>
                        <h5 class="modal-title col-sm-11" id="guessModalLabel">Guess a County</h5>
                        <button type="button" class="close col-sm-1" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                </div>
                <div class="modal-body">
                    <h5>
                        Guess carefully! You will lose if you guess wrong!
                    </h5>
                    <div id="countyPicker">
                        <img class="county Addison" src="Addison.png" onClick="processUserGuess('Addison County')">
                        <img class="county Bennington" src="Bennington.png" onClick="processUserGuess('Bennington County')">
                        <img class="county Caledonia" src="Caledonia.png" onClick="processUserGuess('Caledonia County')">
                        <img class="county Chittenden" src="Chittenden.png" onClick="processUserGuess('Chittenden County')">
                        <img class="county Essex" src="Essex.png" onClick="processUserGuess('Essex County')">
                        <img class="county Franklin" src="Franklin.png" onClick="processUserGuess('Franklin County')">
                        <img class="county Grand-Isle" src="Grand Isle.png" onClick="processUserGuess('Grand Isle County')">
                        <img class="county Lamoille" src="Lamoille.png" onClick="processUserGuess('Lamoille County')">
                        <img class="county Orange" src="Orange.png" onClick="processUserGuess('Orange County')">
                        <img class="county Orleans" src="Orleans.png" onClick="processUserGuess('Orleans County')">
                        <img class="county Rutland" src="Rutland.png" onClick="processUserGuess('Rutland County')">
                        <img class="county Washington" src="Washington.png" onClick="processUserGuess('Washington County')">
                        <img class="county Windham" src="Windham.png" onClick="processUserGuess('Windham County')">
                        <img class="county Windsor" src="Windsor.png" onClick="processUserGuess('Windsor County')">
                        <img class="county Vermont" src="vermont-county-map.png">
                        
                    </div>
                    <!-- <form>
                        <select id='countySelector' class='form-control'>
                            <option selected>Choose a County</option>
                            <option value='Addison County'>Addison County</option>
                            <option value='Bennington County'>Bennington County</option>
                            <option value='Caledonia County'>Caledonia County</option>
                            <option value='Chittenden County'>Chittenden County</option>
                            <option value='Essex County'>Essex County</option>
                            <option value='Franklin County'>Franklin County</option>
                            <option value='Grand Isle County'>Grand Isle County</option>
                            <option value='Lamoille County'>Lamoille County</option>
                            <option value='Orange County'>Orange County</option>
                            <option value='Orleans County'>Orleans County</option>
                            <option value='Rutland County'>Rutland County</option>
                            <option value='Washington County'>Washington County</option>
                            <option value='Windham County'>Windham County</option>
                            <option value='Windsor County'>Windsor County</option>
                        </select>
                    </form> -->
                    <h5 class='hiddenError'>
                        Please guess a county.
                    </h5>
                </div>
                <div class="modal-footer">
                    <button id='cancelGuess' type="button" class="btn btn-secondary" data-dismiss="modal">Cancel Guess</button>
                    <!-- <button id='confirmGuess' type="button" class="btn btn-primary">Guess!</button> -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let randomPointMarker
        var mymap = L.map('mapid', { zoomControl: false }).setView([43.839, -72.625], 8);
        
        mymap.dragging.disable();
        mymap.touchZoom.disable();
        mymap.doubleClickZoom.disable();
        mymap.scrollWheelZoom.disable();
        mymap.boxZoom.disable();
        mymap.keyboard.disable();
        
        var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        });
        Esri_WorldImagery.addTo(mymap)
        
        let vermontBorder = L.geoJSON(border_data);
        vermontBorder.addTo(mymap)
        
        vermontBorder.setStyle({ color: '#22e614' });
        
        
        
        function selectRandomPoint() {
            let boundingBox = {
                maxLon: -73.3654, minLon: -71.5489, maxLat: 45.0065, minLat: 42.7395
            };
            let latMultiplier = boundingBox.maxLat - boundingBox.minLat;
            console.log(latMultiplier)
            let lonMultiplier = boundingBox.maxLon - boundingBox.minLon;
            console.log(lonMultiplier)
            let randomLat = Math.random() * latMultiplier + boundingBox.minLat;
            console.log(randomLat)
            let randomLon = Math.random() * lonMultiplier + boundingBox.minLon;
            console.log(randomLon)
            
            let layer = L.geoJson(border_data);
            let results = leafletPip.pointInLayer([randomLon, randomLat], layer);
            if (results.length > 0) {
                if (randomPointMarker !== undefined) {
                    mymap.removeLayer(randomPointMarker)
                }
                randomPointMarker = L.marker([randomLat, randomLon]);
                randomPointMarker.addTo(mymap)
                mymap.setView([randomLat, randomLon], 17);
                currentLat = randomLat;
                currentLon = randomLon;
                startingLat = randomLat;
                startingLon = randomLon;
                getCountyData(randomLat, randomLon)
            }
            else {
                selectRandomPoint();
            }
            console.log(results)
        }
        function getCountyData(randomLat, randomLon) {
            fetch('https://nominatim.openstreetmap.org/reverse?format=json&lat=' + randomLat + '&lon=' + randomLon)
            .then(function (result) {
                return result.json()
            })
            .then(function(randomJson) {   
                county = randomJson.address.county
            })
        }
        
        function enterHomeScreen() {
            enableStartButton();
            disableGuessButton();
            disableQuitButton();
            disableNavigation();
            hideLatLon();
            resetScore();
        }
        
        function enterPlaying() {
            disableStartButton();
            enableGuessButton();
            enableQuitButton();
            enableNavigation();
            hideLatLon();
            resetScore();
            selectRandomPoint();
            hideBanner();
        }
        
        
        
        
        function enterEndScreen() {
            enableStartButton();
            disableGuessButton();
            disableQuitButton();
            disableNavigation();
            displayLatLon();;
            resetMap();
            //store high score function here
        }
        
        $('#start').click(enterPlaying);
        $('#confirmGuess').click(processUserGuess)
        $('#quit').click(giveUp);
        $('#navUp').click(panUp)
        $('#navLeft').click(panLeft)
        $('#navRight').click(panRight)
        $('#navDown').click(panDown)
        $('#navHome').click(navHome)
        $('#highScoresButton').click(displayHighScores)
        
        function disableStartButton() {
            document.getElementById('start').disabled = true
        }
        function enableStartButton() {
            document.getElementById('start').disabled = false
        }
        function disableGuessButton() {
            document.getElementById('guess').disabled = true
        }
        function enableGuessButton() {
            document.getElementById('guess').disabled = false
        }
        function disableQuitButton() {
            document.getElementById('quit').disabled = true
        }
        function enableQuitButton() {
            document.getElementById('quit').disabled = false
        }
        function disableNavigation() {
            $('#navUp').off('click').css('background-color', 'grey')
            $('#navLeft').off('click').css('background-color', 'grey')
            $('#navRight').off('click').css('background-color', 'grey')
            $('#navDown').off('click').css('background-color', 'grey')
            $('#navHome').off('click').css('background-color', 'grey')
            $('#panButtons').css('background-color', 'grey')
        }
        function enableNavigation() {
            $('#navUp').click(panUp).css('background-color', '#b9c6ef')
            $('#navLeft').click(panLeft).css('background-color', '#b9c6ef')
            $('#navRight').click(panRight).css('background-color', '#b9c6ef')
            $('#navDown').click(panDown).css('background-color', '#b9c6ef')
            $('#navHome').click(navHome).css('background-color', '#b9c6ef')
            $('#panButtons').css('background-color', '#b9c6ef')
        }
        function displayLatLon() {
            $('#lat').text('Latitude: ' + startingLat.toPrecision(6).toString())
            $('#long').text('Longitude: ' + startingLon.toPrecision(6).toString())
            $('#county').text('County: ' + county.split(' ')[0].toString())
        }
        function hideLatLon() {
            $('#lat').text('Latitude: ???')
            $('#long').text('Longitude: ???')
            $('#county').text('County: ???')
        }
        function resetMap() {
            mymap.setView([43.839, -72.625], 8)
        }
        function panUp() {
            currentLat = currentLat + 0.0015;
            mymap.setView([currentLat, currentLon], 17);
            scoreDown()
        }
        function panDown() {
            currentLat = currentLat - 0.0015;
            mymap.setView([currentLat, currentLon], 17);
            scoreDown()
        }
        function panLeft() {
            currentLon = currentLon - 0.0020;
            mymap.setView([currentLat, currentLon], 17);
            scoreDown()
        }
        function panRight() {
            currentLon = currentLon + 0.0020;
            mymap.setView([currentLat, currentLon], 17);
            scoreDown()
        }
        function navHome() {
            currentLat = startingLat;
            currentLon = startingLon;
            mymap.setView([currentLat, currentLon], 17)
            scoreDown()
        }
        function resetScore() {
            score = 100
            $('#score').text('Score: ' + score + '')
        }
        function scoreDown() {
            score--
            $('#score').text('Score: ' + score + '')
        }
        function processUserGuess(guessCounty) {
            console.log(guessCounty)
            if (guessCounty == county){
                processCorrect()
            } else {
                processIncorrect()
            }
        }
        let winMessage = 'You Win! Enter your name to save your score to the High Scores <br><div class="disappearingRow row"><input class="form-control col-sm-10" id="nameInput" type="text" placeholder="Your Name"><button class="col-sm-2 btn btn-primary" id="submitScore">Submit</button></div>'
        function giveUp() {
            processIncorrect()
        }
        function processCorrect() {
            $('#guessModal').modal('hide')
            $('#endBanner').css('display', 'flex').css('background', 'green')
            $('#endBanner > h2').html(winMessage)
            $('#submitScore').click(addScore)
            enterEndScreen()
        }
        
        function addScore() {
            let name = $('#nameInput').val()
            if (localStorage.getItem('highScores')) {
                let highScoreArray = JSON.parse(localStorage.getItem('highScores'))
                highScoreArray.push({"name": name, "score": score})
                localStorage.setItem('highScores', JSON.stringify(highScoreArray))
            } else {
                localStorage.setItem('highScores', '[{"name": ' + name + ', "score": '+score+'}]')
                
            }
            $('#endBanner > h2').html("You Win! High score saved! Play again?")
            displayHighScores()
        }
        function processIncorrect() {
            $('#guessModal').modal('hide')
            $('#endBanner').css('display', 'flex').css('background', 'red')
            $('#endBanner > h2').text('You Lose. Try again?')
            $('#score').text('Score: 0')
            enterEndScreen()
        }
        
        function hideBanner() {
            $('#endBanner').css('display', 'none')
        }
        
        function displayHighScores() {
            $('#highScoresList').html('')
            function compareNumbers(a, b) {
                return b.score - a.score;
            }
            let highScoreArray = JSON.parse(localStorage.getItem('highScores'))
            let sortedScores = highScoreArray.sort(compareNumbers)
            for (entry of sortedScores) {
                
                
                $('#highScoresList').append("<li class='list-group-item'>" +entry.name+ ":  "  + entry.score.toString() + "</li>")      
            }
            
            $('#highScoresModal').modal('show')
        }
        
        
        
        enterHomeScreen()
    </script>
    
    
    
    
</body>


</html>